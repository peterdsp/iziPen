scale_color_manual(values = c("red", "green", "blue"))  # Customize colors
# Show the plot
print(p)
# Load the required libraries (if not already loaded)
library(survival)
# Read the dataset
data <- read.csv("dataHIV.csv")
# Create a survival object
surv.obj <- with(data, Surv(time, death))
# Perform the Logrank test
logrank_test <- survdiff(surv.obj ~ data$mode)
# Perform the Wilcoxon test
wilcox_test <- survdiff(surv.obj ~ data$mode, rho = 0)
# Summarize the results
cat("Logrank Test (Mantel-Haenszel):\n")
print(logrank_test)
cat("\nWilcoxon Test:\n")
print(wilcox_test)
# Load the required libraries (if not already loaded)
library(survival)
# Read the dataset
data <- read.csv("dataHIV.csv")
# Create a survival object
surv.obj <- with(data, Surv(time, death))
# Perform the Logrank test
logrank_test <- survdiff(surv.obj ~ data$mode)
# Perform the Wilcoxon test
wilcox_test <- survdiff(surv.obj ~ data$mode, rho = 0)
# Summarize the results
cat("Logrank Test (Mantel-Haenszel):\n")
print(logrank_test)
cat("\nWilcoxon Test:\n")
print(wilcox_test)
# Load the required libraries (if not already loaded)
library(survival)
library(ggplot2)
# Read the dataset
data <- read.csv("dataHIV.csv")
# Create a survival object
surv.obj <- with(data, Surv(time, death))
# Load the required libraries (if not already loaded)
library(survival)
library(ggplot2)
# Read the dataset
data <- read.csv("dataHIV.csv")
# Create a survival object
surv.obj <- with(data, Surv(time, death))
# Fit a Cox proportional hazards model to assess proportionality
coxph_model <- coxph(surv.obj ~ data$mode)
# Get the estimated cumulative hazard functions
cum_hazards <- survfit(coxph_model)
# Plot the estimated cumulative hazard functions for each risk group
p <- ggplot(cum_hazards, aes(x = time, y = cumhaz, color = strata)) +
geom_step() +
labs(
title = "Estimated Cumulative Hazard Functions by Risk Group",
x = "Time (Years)",
y = "Cumulative Hazard",
color = "Risk Group"
) +
theme_minimal() +
scale_color_manual(values = c("red", "green", "blue"))  # Customize colors
# Show the plot
print(p)
# Load the required libraries (including 'survminer')
library(survival)
library(survminer)
# Read the dataset
data <- read.csv("dataHIV.csv")
# Create a survival object
surv.obj <- with(data, Surv(time, death))
# Fit a Cox proportional hazards model to assess proportionality
coxph_model <- coxph(surv.obj ~ data$mode)
# Get the estimated cumulative hazard functions
cum_hazards <- survfit(coxph_model)
# Create Kaplan-Meier plots for each risk group using ggsurvplot
ggsurvplot(cum_hazards, data = data, risk.table = TRUE, legend.title = "Risk Group", legend.labs = c("MSM", "MSW", "PWID"))
# Plot the estimated cumulative hazard functions for each risk group
p <- ggplot(cum_hazards, aes(x = time, y = cumhaz, color = strata)) +
geom_step() +
labs(
title = "Estimated Cumulative Hazard Functions by Risk Group",
x = "Time (Years)",
y = "Cumulative Hazard",
color = "Risk Group"
) +
theme_minimal() +
scale_color_manual(values = c("red", "green", "blue"))  # Customize colors
# Show the plot
print(p)
# Plot the estimated cumulative hazard functions for each risk group
p <- ggplot(cum_hazards, aes(x = time, y = cumhaz, color = strata)) +
geom_step() +
labs(
title = "Estimated Cumulative Hazard Functions by Risk Group",
x = "Time (Years)",
y = "Cumulative Hazard",
color = "Risk Group"
) +
theme_minimal() +
scale_color_manual(values = c("red", "green", "blue"))  # Customize colors
# Show the plot
print(p)
# Load the required libraries (including 'survminer')
library(survival)
library(survminer)
# Load the required libraries (if not already loaded)
library(survival)
library(ggplot2)
# Read the dataset
data <- read.csv("dataHIV.csv")
# Create a survival object
surv.obj <- with(data, Surv(time, death))
# Fit a Cox proportional hazards model
cox_model <- coxph(surv.obj ~ data$mode)
# Extract cumulative hazard estimates for each risk group
cum_hazard <- survfit(cox_model)
# Plot the cumulative hazard functions
p <- ggplot(data = cum_hazard$data, aes(x = time)) +
geom_step(aes(y = cumhaz, color = strata)) +
labs(
title = "Estimated Cumulative Hazard Functions by Risk Group",
x = "Time (Years)",
y = "Cumulative Hazard",
color = "Risk Group"
) +
theme_minimal() +
scale_color_manual(values = c("red", "green", "blue"))  # Customize colors
# Show the plot
print(p)
# Create a survival object
surv.obj <- with(data, Surv(time, death))
library(ggplot2)
# Read the dataset
data <- read.csv("dataHIV.csv")
# Create a survival object
surv.obj <- with(data, Surv(time, death))
# Fit a Cox proportional hazards model
cox_model <- coxph(surv.obj ~ data$mode)
# Extract cumulative hazard estimates for each risk group
cum_hazard <- survfit(cox_model)
# Plot the cumulative hazard functions
p <- ggplot(data = cum_hazard$data, aes(x = time)) +
geom_step(aes(y = cumhaz, color = strata)) +
labs(
title = "Estimated Cumulative Hazard Functions by Risk Group",
x = "Time (Years)",
y = "Cumulative Hazard",
color = "Risk Group"
) +
theme_minimal() +
scale_color_manual(values = c("red", "green", "blue"))  # Customize colors
# Show the plot
print(p)
# Load the required libraries
library(survival)
library(ggplot2)
# Read the dataset
data <- read.csv("dataHIV.csv")
# Create a survival object
surv.obj <- with(data, Surv(time, death))
# Fit a Cox proportional hazards model
cox_model <- coxph(surv.obj ~ data$mode)
# Extract cumulative hazard estimates for each risk group
cum_hazard <- survfit(cox_model)
# Plot the cumulative hazard functions
p <- ggplot(data = cum_hazard$data, aes(x = time)) +
geom_step(aes(y = cumhaz, color = strata)) +
labs(
title = "Estimated Cumulative Hazard Functions by Risk Group",
x = "Time (Years)",
y = "Cumulative Hazard",
color = "Risk Group"
) +
theme_minimal() +
scale_color_manual(values = c("red", "green", "blue"))  # Customize colors
# Show the plot
print(p)
# Load the required libraries
library(survival)
library(ggplot2)
# Read the dataset
data <- read.csv("dataHIV.csv")
# Create a survival object
surv.obj <- with(data, Surv(time, death))
# Fit a Cox proportional hazards model
cox_model <- coxph(surv.obj ~ data$mode)
# Extract cumulative hazard estimates for each risk group
cum_hazard <- survfit(cox_model)
# Create a data frame for plotting
cum_hazard_data <- data.frame(
time = cum_hazard$time,
cumhaz = -log(cum_hazard$surv),
group = factor(cum_hazard$strata)
)
# Plot the cumulative hazard functions
p <- ggplot(data = cum_hazard_data, aes(x = time, y = cumhaz, color = group)) +
geom_step() +
labs(
title = "Estimated Cumulative Hazard Functions by Risk Group",
x = "Time (Years)",
y = "Cumulative Hazard",
color = "Risk Group"
) +
theme_minimal() +
scale_color_manual(values = c("red", "green", "blue"))  # Customize colors
# Show the plot
print(p)
# Load the required libraries (if not already loaded)
library(survival)
library(ggplot2)
# Read the dataset
data <- read.csv("dataHIV.csv")
# Create a survival object
surv.obj <- with(data, Surv(time, death))
# Fit a Cox proportional hazards model
cox_model <- coxph(surv.obj ~ data$mode)
# Extract cumulative hazard estimates for each risk group
cum_hazard <- survfit(cox_model)
# Create a data frame for plotting with the same number of rows as cum_hazard
cum_hazard_data <- data.frame(
time = cum_hazard$time,
cumhaz = cum_hazard$cumhaz,
group = factor(cum_hazard$strata)
)
# Load the required libraries (if not already loaded)
library(survival)
library(ggplot2)
# Read the dataset
data <- read.csv("dataHIV.csv")
# Create a survival object
surv.obj <- with(data, Surv(time, death))
# Fit a Cox proportional hazards model
cox_model <- coxph(surv.obj ~ mode, data = data)
# Compute the cumulative hazard functions
cum_hazard <- survfit(cox_model, conf.int = FALSE)
# Create a data frame for plotting
cum_hazard_data <- data.frame(
time = cum_hazard$time,
cumhaz = -log(cum_hazard$surv),
group = factor(cum_hazard$strata)
)
# Plot the cumulative hazard functions
p <- ggplot(data = cum_hazard_data, aes(x = time, y = cumhaz, color = group)) +
geom_step() +
labs(
title = "Estimated Cumulative Hazard Functions by Risk Group",
x = "Time (Years)",
y = "Cumulative Hazard",
color = "Risk Group"
) +
theme_minimal() +
scale_color_manual(values = c("red", "green", "blue"))  # Customize colors
# Read the dataset
data <- read.csv("dataHIV.csv")
# Create a survival object
surv.obj <- with(data, Surv(time, death))
# Fit a Cox proportional hazards model
cox_model <- coxph(surv.obj ~ mode, data = data)
# Compute the cumulative hazard functions manually
cum_hazard_data <- data.frame(
time = unique(data$time),  # Unique time points
cumhaz_MSM = cumsum(cox_model$fail[data$mode == "MSM"]) / sum(data$mode == "MSM"),
cumhaz_MSW = cumsum(cox_model$fail[data$mode == "MSW"]) / sum(data$mode == "MSW"),
cumhaz_PWID = cumsum(cox_model$fail[data$mode == "PWID"]) / sum(data$mode == "PWID")
)
# Create a survival object
surv.obj <- with(data, Surv(time, death))
# Fit a Cox proportional hazards model
cox_model <- coxph(surv.obj ~ mode, data = data)
# Calculate the cumulative hazard using base R functions
cumulative_hazard <- function(cox_model) {
n <- length(cox_model$time)
n_risk <- rep(0, n)
cum_hazard <- rep(0, n)
for (i in 1:n) {
n_risk[i] <- sum(cox_model$n.risk[1:i])
cum_hazard[i] <- sum(cox_model$n.event[1:i] / n_risk[i])
}
return(cum_hazard)
}
# Create a data frame for plotting
cum_hazard_data <- data.frame(
time = cox_model$time,
cumhaz = cumulative_hazard(cox_model),
group = factor(cox_model$strata)
)
# Plot the cumulative hazard functions
p <- ggplot(data = cum_hazard_data, aes(x = time, y = cumhaz, color = group)) +
geom_step() +
labs(
title = "Estimated Cumulative Hazard Functions by Risk Group",
x = "Time (Years)",
y = "Cumulative Hazard",
color = "Risk Group"
) +
theme_minimal() +
scale_color_manual(values = c("red", "green", "blue"))
# Show the plot
print(p)
# Load the required libraries (if not already loaded)
library(survival)
library(ggplot2)
# Read the dataset
data <- read.csv("dataHIV.csv")
# Create a survival object
surv.obj <- with(data, Surv(time, death))
# Fit a Cox proportional hazards model
cox_model <- coxph(surv.obj ~ mode, data = data)
# Compute the cumulative hazard functions using survfit
cum_hazard <- survfit(cox_model, conf.int = FALSE)
# Plot the cumulative hazard functions
p <- ggplot(data = cum_hazard$data, aes(x = time)) +
geom_step(aes(y = cumhaz, color = strata)) +
labs(
title = "Estimated Cumulative Hazard Functions by Risk Group",
x = "Time (Years)",
y = "Cumulative Hazard",
color = "Risk Group"
) +
theme_minimal() +
scale_color_manual(values = c("red", "green", "blue"))
# Show the plot
print(p)
# Fit a Cox proportional hazards model
cox_model <- coxph(surv.obj ~ mode, data = data)
# Define a function to calculate the cumulative hazard
cumulative_hazard <- function(cox_model) {
time_points <- unique(cox_model$time)
risk_set_sizes <- sapply(time_points, function(t) sum(cox_model$time >= t))
cumulative_hazard <- -cumsum(cox_model$n.event / risk_set_sizes)
data.frame(time = time_points, cumhazard = cumulative_hazard)
}
# Calculate the cumulative hazard functions
cum_hazard_data <- cumulative_hazard(cox_model)
# Load the required libraries (if not already loaded)
library(survival)
library(ggplot2)
# Read the dataset
data <- read.csv("dataHIV.csv")
# Create a survival object
surv.obj <- with(data, Surv(time, death))
# Fit a Cox proportional hazards model
cox_model <- coxph(surv.obj ~ mode, data = data)
# Define a function to calculate the cumulative hazard
cumulative_hazard <- function(cox_model) {
time_points <- unique(cox_model$time)
risk_set_sizes <- sapply(time_points, function(t) sum(cox_model$time >= t))
cumulative_hazard <- -cumsum(cox_model$n.event / risk_set_sizes)
data.frame(time = time_points, cumhazard = cumulative_hazard)
}
# Calculate the cumulative hazard functions
cum_hazard_data <- cumulative_hazard(cox_model)
# Plot the cumulative hazard functions
p <- ggplot(data = cum_hazard_data, aes(x = time, y = cumhazard)) +
geom_step() +
labs(
title = "Estimated Cumulative Hazard Functions by Risk Group",
x = "Time (Years)",
y = "Cumulative Hazard"
) +
theme_minimal()
# Show the plot
print(p)
# Load the required libraries
library(survival)
≈
library(survminer)
# Read the dataset
data <- read.csv("dataHIV.csv")
# Create a survival object
surv.obj <- with(data, Surv(time, death))
# Fit a Cox proportional hazards model
cox_model <- coxph(surv.obj ~ mode, data = data)
# Compute the cumulative hazard functions
cum_hazard_data <- ggsurvplot(
survfit(cox_model, conf.int = FALSE),
data = data,
pval = TRUE
)
# Show the plot
print(cum_hazard_data)
library(ggplot2)
# Read the dataset
data <- read.csv("dataHIV.csv")
# Create a survival object
surv.obj <- with(data, Surv(time, death))
# Fit a Cox proportional hazards model
cox_model <- coxph(surv.obj ~ mode, data = data)
# Compute the cumulative hazard functions manually
cum_hazard <- survfit(cox_model, conf.int = FALSE)
# Create a data frame for plotting
cum_hazard_data <- data.frame(
time = cum_hazard$time,
cumhaz = -log(cum_hazard$surv),
group = factor(cum_hazard$strata)
)
# Plot the cumulative hazard functions
p <- ggplot(data = cum_hazard_data, aes(x = time, y = cumhaz, color = group)) +
geom_step() +
labs(
title = "Estimated Cumulative Hazard Functions by Risk Group",
x = "Time (Years)",
y = "Cumulative Hazard",
color = "Risk Group"
) +
theme_minimal() +
scale_color_manual(values = c("red", "green", "blue"))
# Load the necessary packages
library(survival)
library(ggplot2)
# Read the dataset
data <- read.csv("dataHIV.csv")
# Fit a Cox proportional hazards model for each risk group
model_msm <- coxph(Surv(time, death) ~ CD4, data = subset(data, mode == "MSM"))
model_msw <- coxph(Surv(time, death) ~ CD4, data = subset(data, mode == "MSW"))
model_pwid <- coxph(Surv(time, death) ~ CD4, data = subset(data, mode == "PWID"))
# Get the estimated cumulative hazard functions for each model
cumhaz_msm <- survfit(model_msm)
cumhaz_msw <- survfit(model_msw)
cumhaz_pwid <- survfit(model_pwid)
# Plot the estimated cumulative hazard functions for each group
ggplot() +
geom_step(data = cumhaz_msm, aes(x = time, y = -log(surv)), color = "blue", linetype = "solid", size = 1) +
geom_step(data = cumhaz_msw, aes(x = time, y = -log(surv)), color = "red", linetype = "dashed", size = 1) +
geom_step(data = cumhaz_pwid, aes(x = time, y = -log(surv)), color = "green", linetype = "dotted", size = 1) +
labs(title = "Cumulative Hazard Functions by Risk Group",
x = "Time (years)",
y = "Cumulative Hazard",
color = "Risk Group") +
scale_color_manual(values = c("blue", "red", "green")) +
theme_minimal()
# Save the plot as an image file if needed
ggsave("cumulative_hazard_plot.png", width = 8, height = 6)
rlang::last_trace()
# Load the necessary packages
library(survival)
library(ggplot2)
# Read the dataset
data <- read.csv("dataHIV.csv")
# Fit a Cox proportional hazards model for each risk group
model_msm <- coxph(Surv(time, death) ~ CD4, data = subset(data, mode == "MSM"))
model_msw <- coxph(Surv(time, death) ~ CD4, data = subset(data, mode == "MSW"))
model_pwid <- coxph(Surv(time, death) ~ CD4, data = subset(data, mode == "PWID"))
# Get the estimated cumulative hazard functions for each model
cumhaz_msm <- survfit(model_msm)
cumhaz_msw <- survfit(model_msw)
cumhaz_pwid <- survfit(model_pwid)
# Extract the survival data
cumhaz_msm_df <- data.frame(time = cumhaz_msm$time, cumhazard = -log(cumhaz_msm$surv), group = "MSM")
cumhaz_msw_df <- data.frame(time = cumhaz_msw$time, cumhazard = -log(cumhaz_msw$surv), group = "MSW")
cumhaz_pwid_df <- data.frame(time = cumhaz_pwid$time, cumhazard = -log(cumhaz_pwid$surv), group = "PWID")
# Combine the data frames
cumhaz_data <- rbind(cumhaz_msm_df, cumhaz_msw_df, cumhaz_pwid_df)
# Plot the estimated cumulative hazard functions for each group
ggplot(data = cumhaz_data, aes(x = time, y = cumhazard, color = group)) +
geom_step() +
labs(title = "Cumulative Hazard Functions by Risk Group",
x = "Time (years)",
y = "Cumulative Hazard",
color = "Risk Group") +
scale_color_manual(values = c("blue", "red", "green")) +
theme_minimal()
# Save the plot as an image file if needed
ggsave("cumulative_hazard_plot.png", width = 8, height = 6)
View(km)
# Load the survival package
library(survival)
# Read the dataset
dataHIV <- read.csv("dataHIV.csv")
# Fit a Cox regression model
cox_model <- coxph(Surv(time, death) ~ mode + CD4, data = dataHIV)
# Summarize the model
summary(cox_model)
# Load the necessary library if not already loaded
# install.packages("survival") # Uncomment and run if you haven't installed the package
library(survival)
# Read the dataset
dataHIV <- read.csv("dataHIV.csv")
# Fit the Cox model with interaction
cox_model <- coxph(Surv(time, death) ~ mode * CD4, data = dataHIV)
# Summarize the model
summary(cox_model)
# Load the necessary libraries
library(dplyr)
library(survival)
# Read the dataset
dataHIV <- read.csv("dataHIV.csv")
# Define the Cox proportional hazards model with CD4 on the original scale
model_original <- coxph(Surv(time, death) ~ CD4 + mode, data = dataHIV)
# Define the Cox proportional hazards model with CD4 on the log10 scale
dataHIV$log_CD4 <- log10(dataHIV$CD4 + 1)
model_log <- coxph(Surv(time, death) ~ log_CD4 + mode, data = dataHIV)
# Define the Cox proportional hazards model with CD4 on the square root scale
dataHIV$sqrt_CD4 <- sqrt(dataHIV$CD4)
model_sqrt <- coxph(Surv(time, death) ~ sqrt_CD4 + mode, data = dataHIV)
# Compare the models using AIC
AIC_original <- AIC(model_original)
AIC_log <- AIC(model_log)
AIC_sqrt <- AIC(model_sqrt)
# Print the AIC values for each model
cat("AIC for Original Scale CD4:", AIC_original, "\n")
cat("AIC for log10 Scale CD4:", AIC_log, "\n")
cat("AIC for Square Root Scale CD4:", AIC_sqrt, "\n")
# Determine the best functional form
if (AIC_original <= AIC_log && AIC_original <= AIC_sqrt) {
cat("The original scale is the best functional form for CD4.")
} else if (AIC_log <= AIC_original && AIC_log <= AIC_sqrt) {
cat("The log10 scale is the best functional form for CD4.")
} else {
cat("The square root scale is the best functional form for CD4.")
}
